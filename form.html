<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Professional CRUD Form</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  body { padding: 20px; background: #f8f9fa; }
  .status { margin-top: 10px; }
  table td, table th { vertical-align: middle; }
</style>
</head>
<body>

<div class="container">
  <h2 class="mb-4 text-center">Contact Form & Entries</h2>

  <!-- Form Card -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <input type="hidden" id="id">
      <div class="row g-3">
        <div class="col-md-6">
          <input type="text" class="form-control" id="name" placeholder="Name">
        </div>
        <div class="col-md-6">
          <input type="email" class="form-control" id="email" placeholder="Email">
        </div>
        <div class="col-md-6">
          <input type="text" class="form-control" id="phone" placeholder="Phone">
        </div>
        <div class="col-md-6">
          <textarea class="form-control" id="message" placeholder="Message"></textarea>
        </div>
      </div>
      <div class="mt-3">
        <button class="btn btn-primary" onclick="submitForm()">Submit</button>
        <span id="status" class="status text-success"></span>
      </div>
    </div>
  </div>

  <!-- Table Card -->
  <div class="card shadow-sm">
    <div class="card-body">
      <h5 class="card-title">All Entries</h5>
      <div class="table-responsive">
        <table class="table table-striped table-hover" id="dataTable">
          <thead class="table-dark">
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Message</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbzV44up0iKG80CZ8HMaACP6OM5M_wp_8M4wiG4q86yDgLyUCRaeDU-DUSksZg7422Fy/exec"; // আপনার Web App URL বসান

async function submitForm() {
  let id = document.getElementById("id").value;
  let action = id ? "update" : "add";

  let form = new FormData();
  form.append("action", action);
  if(id) form.append("id", id);
  form.append("name", document.getElementById("name").value);
  form.append("email", document.getElementById("email").value);
  form.append("phone", document.getElementById("phone").value);
  form.append("message", document.getElementById("message").value);

  try {
    let res = await fetch(API, { method:"POST", body: form });
    let txt = await res.text();
    document.getElementById("status").innerText = txt;
    clearForm();
    loadData();
    setTimeout(()=>{document.getElementById("status").innerText="";}, 500);
  } catch(err) {
    alert("Error: " + err);
  }
}

function clearForm() {
  document.getElementById("id").value="";
  document.getElementById("name").value="";
  document.getElementById("email").value="";
  document.getElementById("phone").value="";
  document.getElementById("message").value="";
}

async function loadData() {
  try {
    let res = await fetch(API);
    let data = await res.json();
    let tbody = "";
    data.forEach(d => {
      tbody += `<tr>
        <td>${d.id}</td>
        <td>${d.name}</td>
        <td>${d.email}</td>
        <td>${d.phone}</td>
        <td>${d.message}</td>
        <td>${d.date}</td>
        <td>
          <button class="btn btn-sm btn-warning" onclick="edit(${d.id},'${d.name}','${d.email}','${d.phone}','${d.message}')">Edit</button>
          <button class="btn btn-sm btn-danger" onclick="del(${d.id})">Delete</button>
        </td>
      </tr>`;
    });
    document.querySelector("#dataTable tbody").innerHTML = tbody;
  } catch(err) {
    document.querySelector("#dataTable tbody").innerHTML = "<tr><td colspan='7'>Error loading data</td></tr>";
  }
}

function edit(id,name,email,phone,message) {
  document.getElementById("id").value = id;
  document.getElementById("name").value = name;
  document.getElementById("email").value = email;
  document.getElementById("phone").value = phone;
  document.getElementById("message").value = message;
}

async function del(id) {
  if(!confirm("Are you sure to delete?")) return;
  let form = new FormData();
  form.append("action","delete");
  form.append("id",id);
  try {
    await fetch(API, {method:"POST", body: form});
    loadData();
  } catch(err) {
    alert("Error: "+err);
  }
}

// Load table on page load
loadData();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
