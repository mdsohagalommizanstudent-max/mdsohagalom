<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>ID Card Entry</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
  <h4 class="text-center">ID Card Information</h4>

  <input type="file" id="photo" class="form-control mb-2" onchange="previewImage()">
  <img id="preview" src="" style="display:none; max-width:150px; border:1px solid #ccc; padding:5px;" class="mb-3">

  <input type="text" id="name" class="form-control mb-2" placeholder="নাম">
  <input type="text" id="designation" class="form-control mb-2" placeholder="পদবী">
  
  <select id="branch" class="form-control mb-2">
    <option value="">শাখা নির্বাচন করুন</option>
    <option>প্রধান শাখা</option>
    <option>জিয়াপার্ক শাখা</option>
    <option>কয়েরদাঁড়া শাখা</option>
  </select>

  <input type="text" id="village" class="form-control mb-2" placeholder="গ্রাম">
  <input type="text" id="post" class="form-control mb-2" placeholder="পোষ্ট">
  <input type="text" id="thana" class="form-control mb-2" placeholder="থানাঃ">
  <input type="text" id="district" class="form-control mb-2" placeholder="জেলাঃ">
  <input type="text" id="birthYear" class="form-control mb-2" placeholder="জন্ম সাল">
  <input type="text" id="nid" class="form-control mb-2" placeholder="জন্মনিবন্ধন / ভোটার আইডি নম্বর">
  <input type="text" id="blood" class="form-control mb-2" placeholder="রক্তের গ্রুপ">
  <input type="text" id="mobile" class="form-control mb-2" placeholder="মোবাইল নং">

  <button id="submitBtn" class="btn btn-primary w-100" onclick="submitData()">Submit</button>
  <p class="text-info text-center mt-2" id="msg"></p>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbzMYRcn1Wba54FL4jQpsPi_1z1dG-vn8sPiLbGS3Zpx7QP5BfNT6yy0dyhfAfXcZSZjuw/exec";

function previewImage(){
  const file = document.getElementById("photo").files[0];
  const preview = document.getElementById("preview");
  if(file){
    const reader = new FileReader();
    reader.onload = function(e){
      preview.src = e.target.result;
      preview.style.display = "block";
    }
    reader.readAsDataURL(file);
  }
}

function toBase64(file){
  return new Promise((res, rej)=>{
    const reader = new FileReader();
    reader.onload = ()=>res(reader.result);
    reader.onerror = err=>rej(err);
    reader.readAsDataURL(file);
  });
}

async function submitData(){
  const btn = document.getElementById("submitBtn");
  btn.disabled = true;
  document.getElementById("msg").innerText = "একটু অপেক্ষা করুন...";

  const img = document.getElementById("photo").files[0];
  if(!img){ alert("ছবি দিন"); btn.disabled=false; return; }

  const form = new FormData();
  form.append("name", document.getElementById("name").value);
  form.append("designation", document.getElementById("designation").value);
  form.append("branch", document.getElementById("branch").value);
  form.append("village", document.getElementById("village").value);
  form.append("post", document.getElementById("post").value);
  form.append("thana", document.getElementById("thana").value);
  form.append("district", document.getElementById("district").value);
  form.append("birthYear", document.getElementById("birthYear").value);
  form.append("nid", document.getElementById("nid").value);
  form.append("blood", document.getElementById("blood").value);
  form.append("mobile", document.getElementById("mobile").value);
  form.append("image", await toBase64(img));

  try{
    const res = await fetch(API, { method:"POST", body: form });
    const data = await res.json();
    if(data.status=="success"){
      document.getElementById("msg").innerText = "✅ সম্পূর্ণ হয়েছে, অন্যজনের জন্য চেষ্টা করুন";
      document.querySelectorAll("input,select").forEach(e=>e.value="");
      document.getElementById("preview").style.display="none";
    } else {
      document.getElementById("msg").innerText = "❌ Error: "+(data.msg||"Unknown");
    }
  } catch(err){
    document.getElementById("msg").innerText = "❌ Error: "+err;
  }
  btn.disabled=false;
}
</script>

